# @aurora-generated
# @source cliter/business-partner-portal/supplier-document.aurora.yaml
enum BusinessPartnerPortalSupplierDocumentDocumentType {
  INVOICE
  CREDIT_NOTE
  DEBIT_NOTE
  PROFORMA
  OTHER
}

enum BusinessPartnerPortalSupplierDocumentStatus {
  PENDING_UPLOAD
  UPLOADED
  VALIDATING
  SENT_FOR_PROCESSING
  PROCESSING
  PROCESSED
  LINKED
  ERROR
  REJECTED
}

type BusinessPartnerPortalSupplierDocument {
  """
  Unique identifier for the supplier document upload. UUID v4 format, generated automatically on creation. Used as primary key for tracking document lifecycle and referencing in external system integration callbacks.
  """
  id: ID!
  """
  Auto-incrementing sequential identifier for the supplier document. Used for internal ordering, human-readable reference (e.g., &quot;DOC-00001234&quot;), and optimized queries. Not exposed in external APIs. Provides stable identifier for database operations.
  """
  rowId: GraphQLInt!
  """
  Foreign key to the business partner (supplier) who uploaded this document. Required field - every document must be associated with a supplier. Used to filter documents by supplier in the portal view, validate upload permissions, and associate with supplier master data. Partner type should be SUPPLIER or VENDOR.
  """
  businessPartnerId: ID!
  businessPartner: BusinessPartnerPortalBusinessPartner
  """
  Unique internal document number assigned on upload. Follows sequential format (e.g., &quot;SDOC-2024-000001&quot;). Used as primary reference in communications with supplier and integration logs. Cannot be changed after creation. Generated automatically by the system.
  """
  documentNumber: GraphQLString
  """
  Classification of the uploaded document. INVOICE: Standard supplier invoice for goods/services. CREDIT_NOTE: Adjustment reducing amount owed. DEBIT_NOTE: Adjustment increasing amount owed. PROFORMA: Preliminary invoice for review. OTHER: Miscellaneous supporting documents. Used by the processing system to apply appropriate processing rules.
  """
  documentType: BusinessPartnerPortalSupplierDocumentDocumentType
  """
  Current processing status of the document. PENDING_UPLOAD: Upload initiated but file not yet received. UPLOADED: File received and stored successfully. VALIDATING: Basic validation in progress (format, size, virus scan). SENT_FOR_PROCESSING: Document transmitted to external system for OCR processing. PROCESSING: External system actively processing (OCR, data extraction). PROCESSED: Processing completed, data available. LINKED: Purchase invoice created and linked to this document. ERROR: Processing failed (see errorCode/errorMessage). REJECTED: Document rejected by external system or manually.
  """
  status: BusinessPartnerPortalSupplierDocumentStatus!
  """
  File metadata and storage information in JSON format. Contains file name, original name, MIME type, size in bytes, storage path/URL, and upload timestamp. Used for file retrieval, display in portal, and storage management. NULL if upload not completed. Structure: {fileName: string, originalName: string, mimeType: string, size: number, path: string, uploadedAt: timestamp}.
  """
  file: JSON
  """
  SHA-256 hash of the uploaded file content. Used for duplicate detection (prevent same invoice uploaded twice), integrity verification, and audit trail. Calculated server-side after upload completes. NULL during upload or if calculation fails. Indexed for fast duplicate lookups. 64 chars for hex-encoded SHA-256.
  """
  fileHash: GraphQLString
  """
  Invoice number as provided by the supplier on upload or extracted from document by OCR. Used for reference before processing completes. May differ from OCR-extracted value (see ocrInvoiceNumber). NULL if not provided by supplier. Indexed for supplier lookups when checking upload status.
  """
  supplierInvoiceNumber: GraphQLString
  """
  Invoice date as provided by the supplier on upload. Used for reference and initial validation before processing. May be corrected by OCR results. NULL if not provided by supplier. Helps prioritize processing by invoice age.
  """
  supplierInvoiceDate: GraphQLISODateTime
  """
  Total invoice amount as declared by supplier on upload. Used for initial validation and matching against OCR results. NULL if not provided. Discrepancies between declared and OCR-extracted amounts may trigger review workflow. Stored in supplier&#x27;s declared currency.
  """
  supplierInvoiceAmount: GraphQLFloat
  """
  ISO 4217 currency code for the invoice amount (e.g., &quot;USD&quot;, &quot;EUR&quot;, &quot;MXN&quot;). As declared by supplier or extracted by OCR. NULL if not specified. Used for amount validation and purchase invoice creation.
  """
  currencyCode: GraphQLString
  """
  Document ID assigned by the external processing system after successful processing. Format depends on external system configuration. NULL until processing completes. Used to query external system for processing results and link back. Primary reference for external integration. Indexed for fast lookups on webhook callbacks.
  """
  externalDocumentId: GraphQLString
  """
  Company code in the external system where the invoice will be posted. Determined by business rules based on supplier and document type. NULL until external system assignment. Used for routing to correct instance in multi-company environments.
  """
  externalCompanyCode: GraphQLString
  """
  Detailed processing status from the external system. Provides granular status beyond our simplified enum (e.g., &quot;OCR_COMPLETE&quot;, &quot;VALIDATION_PENDING&quot;, &quot;POSTED&quot;, &quot;PARKED&quot;). NULL until external system begins processing. Updated via webhook or polling. Used for detailed status display and troubleshooting.
  """
  externalProcessingStatus: GraphQLString
  """
  Foreign key to the purchase invoice header created from this document after processing. NULL until processing completes and invoice is created in our system. Establishes the link between uploaded document and registered invoice. Allows supplier to navigate from their upload to the resulting invoice record. Set when status transitions to LINKED.
  """
  purchaseInvoiceHeaderId: ID
  purchaseInvoiceHeader: BusinessPartnerPortalPurchaseInvoiceHeader
  """
  Overall OCR confidence score from the processing system (0.00 to 100.00). Indicates reliability of extracted data. NULL until OCR completes. Low scores may trigger manual review. Used for quality metrics and processing decisions. Display as percentage in UI. Scores below threshold (e.g., 80%) may require manual verification.
  """
  ocrConfidenceScore: GraphQLFloat
  """
  Raw OCR extraction results from the processing system in JSON format. Contains structured data extracted from document: invoice number, date, line items, amounts, vendor info, tax details, etc. NULL until OCR completes. Used to create purchase invoice and for displaying extracted data to supplier for verification. Schema depends on processing system configuration.
  """
  ocrData: JSON
  """
  Timestamp when document was transmitted to the external processing system. NULL until transmission occurs. Used for SLA tracking, processing time metrics, and troubleshooting delays. Set when status transitions to SENT_FOR_PROCESSING.
  """
  sentForProcessingAt: GraphQLTimestamp
  """
  Timestamp when the external system completed processing (success or failure). NULL until processing completes. Used for SLA tracking, processing time metrics, and audit trail. Set when status transitions to PROCESSED, ERROR, or REJECTED. Processing time &#x3D; processedAt - sentForProcessingAt.
  """
  processedAt: GraphQLTimestamp
  """
  Timestamp when purchase invoice was created and linked to this document. NULL until linking occurs. Set when status transitions to LINKED. Represents the moment the supplier&#x27;s invoice becomes a registered purchase invoice in the system.
  """
  linkedAt: GraphQLTimestamp
  """
  Error code from the external processing system or internal validation when processing fails. NULL if no error. Standardized codes for programmatic handling (e.g., &quot;OCR_FAILED&quot;, &quot;INVALID_FORMAT&quot;, &quot;DUPLICATE_INVOICE&quot;, &quot;VENDOR_MISMATCH&quot;, &quot;PROCESSING_TIMEOUT&quot;). Indexed for error analysis and reporting. Used with errorMessage for full context.
  """
  errorCode: GraphQLString
  """
  Human-readable error message when processing fails. NULL if no error. Provides detailed explanation for supplier and support staff. May contain technical details from external system or validation rules. Displayed in portal when status is ERROR or REJECTED. Not used for programmatic decisions (use errorCode instead).
  """
  errorMessage: GraphQLString
  """
  Number of times processing has been retried after failure. Starts at 0. Incremented on each retry attempt. Used to limit automatic retries (e.g., max 3) and track problematic documents. High retry count indicates persistent issues requiring manual intervention.
  """
  retryCount: GraphQLInt!
  """
  Timestamp of the last retry attempt. NULL if never retried. Used for retry scheduling (exponential backoff), preventing too-frequent retries, and audit trail. Updated each time a retry is initiated.
  """
  lastRetryAt: GraphQLTimestamp
  """
  Internal notes about the document processing. Can include manual review comments, special handling instructions, or resolution notes for errors. NULL indicates no notes. Not visible to supplier unless explicitly shared. Used by accounts payable staff for coordination and documentation.
  """
  notes: GraphQLString
  """
  Notes provided by the supplier during upload. Can include context about the invoice, special instructions, or references to related documents/POs. NULL if no notes provided. Visible to both supplier and internal staff. May be passed to the processing system as additional context.
  """
  supplierNotes: GraphQLString
  """
  Indicates if the document has been archived after successful processing. Archived documents may be moved to cold storage and excluded from active listings. Set to true after document is linked and retention period passes. Used for storage optimization and list filtering. Defaults to false.
  """
  isArchived: GraphQLBoolean!
  """
  Timestamp when the document record was created (upload initiated). Automatically set on record creation. Part of audit trail for tracking document lifecycle. Used for reporting on upload patterns and SLA calculations.
  """
  createdAt: GraphQLTimestamp
  """
  Timestamp of the last modification to this document record. Automatically updated on any field change. Used for tracking document state changes, cache invalidation, and audit compliance. Important for monitoring processing progress.
  """
  updatedAt: GraphQLTimestamp
  """
  Soft delete timestamp. NULL indicates active document. When set, document is hidden from normal queries but preserved for audit purposes. Deleted documents remain accessible for compliance and historical queries. Physical file may be retained per retention policy even when record is soft-deleted.
  """
  deletedAt: GraphQLTimestamp
}

input BusinessPartnerPortalCreateSupplierDocumentInput {
  id: ID!
  businessPartnerId: ID!
  documentNumber: GraphQLString
  documentType: BusinessPartnerPortalSupplierDocumentDocumentType
  status: BusinessPartnerPortalSupplierDocumentStatus!
  file: JSON
  fileHash: GraphQLString
  supplierInvoiceNumber: GraphQLString
  supplierInvoiceDate: GraphQLISODateTime
  supplierInvoiceAmount: GraphQLFloat
  currencyCode: GraphQLString
  externalDocumentId: GraphQLString
  externalCompanyCode: GraphQLString
  externalProcessingStatus: GraphQLString
  purchaseInvoiceHeaderId: ID
  ocrConfidenceScore: GraphQLFloat
  ocrData: JSON
  sentForProcessingAt: GraphQLTimestamp
  processedAt: GraphQLTimestamp
  linkedAt: GraphQLTimestamp
  errorCode: GraphQLString
  errorMessage: GraphQLString
  retryCount: GraphQLInt!
  lastRetryAt: GraphQLTimestamp
  notes: GraphQLString
  supplierNotes: GraphQLString
  isArchived: GraphQLBoolean!
}

input BusinessPartnerPortalUpdateSupplierDocumentByIdInput {
  id: ID!
  businessPartnerId: ID
  documentNumber: GraphQLString
  documentType: BusinessPartnerPortalSupplierDocumentDocumentType
  status: BusinessPartnerPortalSupplierDocumentStatus
  file: JSON
  fileHash: GraphQLString
  supplierInvoiceNumber: GraphQLString
  supplierInvoiceDate: GraphQLISODateTime
  supplierInvoiceAmount: GraphQLFloat
  currencyCode: GraphQLString
  externalDocumentId: GraphQLString
  externalCompanyCode: GraphQLString
  externalProcessingStatus: GraphQLString
  purchaseInvoiceHeaderId: ID
  ocrConfidenceScore: GraphQLFloat
  ocrData: JSON
  sentForProcessingAt: GraphQLTimestamp
  processedAt: GraphQLTimestamp
  linkedAt: GraphQLTimestamp
  errorCode: GraphQLString
  errorMessage: GraphQLString
  retryCount: GraphQLInt
  lastRetryAt: GraphQLTimestamp
  notes: GraphQLString
  supplierNotes: GraphQLString
  isArchived: GraphQLBoolean
}

input BusinessPartnerPortalUpdateSupplierDocumentsInput {
  id: ID
  businessPartnerId: ID
  documentNumber: GraphQLString
  documentType: BusinessPartnerPortalSupplierDocumentDocumentType
  status: BusinessPartnerPortalSupplierDocumentStatus
  file: JSON
  fileHash: GraphQLString
  supplierInvoiceNumber: GraphQLString
  supplierInvoiceDate: GraphQLISODateTime
  supplierInvoiceAmount: GraphQLFloat
  currencyCode: GraphQLString
  externalDocumentId: GraphQLString
  externalCompanyCode: GraphQLString
  externalProcessingStatus: GraphQLString
  purchaseInvoiceHeaderId: ID
  ocrConfidenceScore: GraphQLFloat
  ocrData: JSON
  sentForProcessingAt: GraphQLTimestamp
  processedAt: GraphQLTimestamp
  linkedAt: GraphQLTimestamp
  errorCode: GraphQLString
  errorMessage: GraphQLString
  retryCount: GraphQLInt
  lastRetryAt: GraphQLTimestamp
  notes: GraphQLString
  supplierNotes: GraphQLString
  isArchived: GraphQLBoolean
}

type Query {
  businessPartnerPortalFindSupplierDocument(
    query: QueryStatement
    constraint: QueryStatement
  ): BusinessPartnerPortalSupplierDocument

  businessPartnerPortalFindSupplierDocumentById(
    id: ID
    constraint: QueryStatement
  ): BusinessPartnerPortalSupplierDocument

  businessPartnerPortalGetSupplierDocuments(
    query: QueryStatement
    constraint: QueryStatement
  ): [BusinessPartnerPortalSupplierDocument]!

  businessPartnerPortalPaginateSupplierDocuments(
    query: QueryStatement
    constraint: QueryStatement
  ): Pagination!
}

type Mutation {
  businessPartnerPortalCreateSupplierDocument(
    payload: BusinessPartnerPortalCreateSupplierDocumentInput!
  ): BusinessPartnerPortalSupplierDocument

  businessPartnerPortalUpdateSupplierDocumentById(
    payload: BusinessPartnerPortalUpdateSupplierDocumentByIdInput!
    constraint: QueryStatement
  ): BusinessPartnerPortalSupplierDocument

  businessPartnerPortalDeleteSupplierDocumentById(
    id: ID!
    constraint: QueryStatement
  ): BusinessPartnerPortalSupplierDocument
}
